MODULE EGM_test
VAR egmident egmID1;
VAR egmstate egmSt1;

! limits for cartesian convergence: +-1 mm
CONST egm_minmax egm_minmax1:=[-1,1];
PROC main()
testuc;
ENDPROC
PROC testuc()
EGMReset egmID1;
EGMGetId egmID1;
egmSt1:=EGMGetState(egmID1);
TPWrite "EGM state: "\Num:=egmSt1;
IF egmSt1 <= EGM_STATE_CONNECTED THEN
! Set up the EGM data source: UdpUc server using device "EGMsensor:"
! and configuration "default"
EGMSetupUC ROB_L, egmID1, "default", "EGMsensor:" \Joint\ CommTimeout:=10;
ENDIF
! Correction frame is the World coordinate system and the sensor
! measurements are relative to the tool frame of the used tool
! (tFroniusCMT)
EGMActJoint egmID1, \J1:=egm_minmax1 \J2:=egm_minmax1 \J3:=egm_minmax1 \J4:=egm_minmax1 \J5:=egm_minmax1 \J6:=egm_minmax1 \J7:=egm_minmax1;
! Run: the convergence condition has to be fulfilled during
! 2 seconds before RAPID execution continues to the next
! instruction
EGMRunJoint egmID1, EGM_STOP_HOLD \J1 \J2 \J3 \J4 \J5 \J6 \J7 \RampInTime:=0.05;
egmSt1:=EGMGetState(egmID1);
IF egmSt1 = EGM_STATE_CONNECTED THEN
TPWrite "Reset EGM instance egmID1";
EGMReset egmID1;
ENDIF
ENDPROC
ENDMODULE